version: '3.9'

services:
  zookeeper-01:
    environment:
      - ZOO_SERVER_ID=1
      - ZOO_SERVERS=0.0.0.0:2888:3888,zookeeper-02:2888:3888,zookeeper-03:2888:3888
    deploy:
      placement:
        constraints:
          - "node.labels.name==node-1"
      resources:
        limits:
          cpus: ${ZOOKEEPER_CPU_LIMIT}
          memory: ${ZOOKEEPER_MEMORY_LIMIT}
        reservations:
          cpus: ${ZOOKEEPER_CPU_RESERVE}
          memory: ${ZOOKEEPER_MEMORY_RESERVE}

  zookeeper-02:
    image: bitnami/zookeeper:3.7.0
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes
      - ZOO_SERVER_ID=2
      - ZOO_SERVERS=zookeeper-01:2888:3888,0.0.0.0:2888:3888,zookeeper-03:2888:3888
    volumes:
      - zookeeper-02-volume:/bitnami/zookeeper
    deploy:
      placement:
        constraints:
          - "node.labels.name==node-2"
      resources:
        limits:
          cpus: ${ZOOKEEPER_CPU_LIMIT}
          memory: ${ZOOKEEPER_MEMORY_LIMIT}
        reservations:
          cpus: ${ZOOKEEPER_CPU_RESERVE}
          memory: ${ZOOKEEPER_MEMORY_RESERVE}

  zookeeper-03:
    image: bitnami/zookeeper:3.7.0
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes
      - ZOO_SERVER_ID=3
      - ZOO_SERVERS=zookeeper-01:2888:3888,zookeeper-02:2888:3888,0.0.0.0:2888:3888
    volumes:
      - zookeeper-03-volume:/bitnami/zookeeper
    deploy:
      placement:
        constraints:
          - "node.labels.name==node-3"
      resources:
        limits:
          cpus: ${ZOOKEEPER_CPU_LIMIT}
          memory: ${ZOOKEEPER_MEMORY_LIMIT}
        reservations:
          cpus: ${ZOOKEEPER_CPU_RESERVE}
          memory: ${ZOOKEEPER_MEMORY_RESERVE}

volumes:
  zookeeper-02-volume:
  zookeeper-03-volume:
